\documentclass[10pt, a4paper]{article}

\include{includes}

\title{PaP}
\author{BERASATEGUY Tanguy, GOEDEFROIT Charles}

\begin{document}

% Front page
\vspace*{\stretch{1}}
\begin{center}
    \textbf{\LARGE\MyTitle}
    \\[.5cm]
    \textbf{Projet : rapport2}
    \\[.5cm]
    4TIN804U
    \\[.5cm]
    \MyAuthor
\end{center}
\vspace*{\stretch{1}}

\newpage

\tableofcontents

\newpage

\section{ILP optimization (4.1)}

On a fait les modifications :

Pour \emph{ssandPile\_do\_tile\_opt()} on a retiré les appels à \em{table(out, i, j)}
pour passer par une varaible intermediaire result. Cette modification permet au compilateur
de vectoriser car il peut maintenant facilement voir que les différentes lignes peuvent être 
calculés en parallels.\\

Nous avons modifié ces lignes :
\inputminted[
    frame=lines,
    framesep=2mm,
    baselinestretch=1.2,
    fontsize=\footnotesize,
    linenos,
    firstline=1,
    lastline=25
]{diff}{codes/sync_do_tile_opt.c}

Le code de la fonction final :
\inputminted[
    frame=lines,
    framesep=2mm,
    baselinestretch=1.2,
    fontsize=\footnotesize,
    linenos,
    firstline=27,
    lastline=45
]{c}{codes/sync_do_tile_opt.c}

Nous avons verifié et on obtient le même résultats et le même nombre d'iterations (69190)
avec la version par défaut et la version opt.\\
\begin{figure}[H]
    \centering
    \begin{subfigure}{.4\textwidth}
        \includegraphics[width=1\linewidth]{dump-ssandPile-seq-dim-512-iter-69190_default}
        \caption{\small{avec do\_tile\_default}}
        \label{fig:ssandPile_default}
    \end{subfigure}
    \begin{subfigure}{.4\textwidth}
        \includegraphics[width=1\linewidth]{dump-ssandPile-seq-dim-512-iter-69190_opt}
        \caption{\small{avec do\_tile\_opt}}
        \label{fig:ssandPile_opt}
    \end{subfigure}
    \caption{Verification du résultats pour ssandPile}
\end{figure}

Le gain de performance est de $2.37$ car $\frac{178812}{75408}$
\\[0.5cm]

Pour \emph{asandPile\_do\_tile\_opt()} on a retiré les appels à \em{atable(i, j)} pour passer par une variable intermédiaire result. Cette modification permet au compilateur
de vectoriser car il peut maintenant facilement voir que les différentes lignes peuvent être calculés en parallele.

Nous avons modifié ces lignes :
\inputminted[
    frame=lines,
    framesep=2mm,
    baselinestretch=1.2,
    fontsize=\footnotesize,
    linenos,
    firstline=1,
    lastline=24
]{diff}{codes/async_do_tile_opt.c}

Le code de la fonction final :
\inputminted[
    frame=lines,
    framesep=2mm,
    baselinestretch=1.2,
    fontsize=\footnotesize,
    linenos,
    firstline=26,
    lastline=46
]{c}{codes/async_do_tile_opt.c}

Nous avons verifié et on obtient le même résultat et le même nombre d'iterations (34938)
avec la version par défaut et la version opt.\\
\begin{figure}[H]
    \centering
    \begin{subfigure}{.4\textwidth}
        \includegraphics[width=1\linewidth]{dump-asandPile-seq-dim-512-iter-34938_default}
        \caption{\small{avec do\_tile\_default}}
        \label{fig:asandPile_default}
    \end{subfigure}
    \begin{subfigure}{.4\textwidth}
        \includegraphics[width=1\linewidth]{dump-asandPile-seq-dim-512-iter-34938_opt}
        \caption{\small{avec do\_tile\_opt}}
        \label{fig:asandPile_opt}
    \end{subfigure}
    \caption{Verification du résultats pour asandPile}
\end{figure}

Le gain de performance est de $1.2$ car $\frac{37990}{31405}$

\section{OpenMP implementation of the synchronous version (4.2)}

\begin{figure}[h]
    \centering
    \includegraphics[width=1\linewidth]{ssand_omp.pdf}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{ssand_omp_tiled.pdf}
\end{figure}

\section{OpenMP implementation of the asynchronous version (4.3)}

Pour paralleliser avec \emph{asandPile_compute_omp_tiled}, il a fallu créer 4 nids de boucles afin d'éviter les lectures/écritures concurentes.
On a donc un nid de boucle pour les lignes et colonnes impaires, un pour les lignes impaires et colonnes paires, un pour les lignes paires et colonnes impaires, et un pour les lignes et colonnes paires.


\section{Lazy OpenMP implementations (4.4)}



% \begin{listing}[!ht]
%     \inputminted[
%         frame=lines,
%         framesep=2mm,
%         baselinestretch=1.2,
%         fontsize=\footnotesize,
%         linenos
%     ]{c}{codes/test.c}
%     \caption{Example from external file}
%     \label{listing:1}
% \end{listing}

% \includegraphics[height=1.5cm]{<image>}

\end{document}